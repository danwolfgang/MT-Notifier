MT-Notifier: Configure subscriptions to your blog.
A Plugin for Movable Type

Release 2.2.4
September 6, 2004

http://jayseae.cxliv.org/notifier/
http://www.amazon.com/o/registry/2Y29QET3Y472A/

Copyright 2003-2004, Chad Everett (software@cxliv.org)
~Licensed under the Open Software License version 2.1~

If you find the software useful or even like it, then a simple 'thank you'
is always appreciated.  A reference back to me is even nicer.  If you find
a way to make money from the software, do what you feel is right.

*** -------------------------------------------------------------------- ***

This Movable Type plugin allows you to provide a subscription service to
your users so that they can keep up on changes to your site without having
to check back repeatedly.  Notifier also has support for opt-out records, to
allow users to indicate that they no longer wish to receive notifications.

MT-Notifier automatically handles blog security, allowing logged-in users to
see only the blogs to which they have access, and requiring a unique security
code for each user to modify their subscriptions.

MT-Notifier currently requires the use of the PluginData table, and in turn,
this requires the Storable Perl module to be installed on your system.  Version
2.0 of MT-Notifier also requires certain features found in MT 3.0D, and should
not be used with a prior version of Movable Type.

*** -------------------------------------------------------------------- ***

Installation:

- Install the necessary files to your web server:

  mt-notifier.cgi to your main MT directory (chmod to 755)

  notifier.pm to extlib/jayseae/notifier.pm under your main MT directory

  Notifier.pl to plugins/Notifier.pl under your main MT directory

  notifier.tmpl to tmpl/cms/notifier.tmpl under your main MT directory

  notification.tmpl to tmpl/email/notification.tmpl under your main MT directory

- Installation should look like this:

  MT_DIR/mt-notifier.cgi
  MT_DIR/extlib/jayseae/notifier.pm
  MT_DIR/plugins/Notifier.pl
  MT_DIR/tmpl/cms/notifier.tmpl
  MT_DIR/tmpl/email/notification.tmpl

- Using a browser, connect to mt-notifier.cgi for configuration:

  http://www.example.com/cgi-bin/mt/mt-notifier.cgi?__mode=mnu

You are required to login to access manual mode, which provides you with a
menu of options.  After logging in to your Movable Type account, you are
presented with a menu of choices.

- Configure

The configuration option allows you to define a default sender address for
your notifications, install MT-Notifier to (and remove from, if you should so
desire) your Movable Type installation and also configure email notifications
for each blog on your system.  Email notifications do not need to be enabled
in order to configure MT-Notifier, but they must be on in order for your
system to actually send notifications.

- Manage

The manage option allows you to review all subscription information for your
system.  You can create new subscriptions, manage by email address (for existing
subscriptions only), by blog, by category or by entry.

- Purge

The purge option allows you to remove records from your system.  There is also
an advanced purge option, accessible from this screen, which allow for even
greater control over the purge.  Be careful before executing a purge request -
you may lose data!

- Transfer

The transfer option allows you to import subscription records from other comment
notification systems into MT-Notifier.  MT-Notifier version 1 subscriptions, EZ
Subscribe to Comments subscriptions and Scripty Goddess subscriptions are currently supported.

*** -------------------------------------------------------------------- ***

Installation:

Everything required for notifications is installed when you move the individual
files to your server.  However, two settings within the plugin may make it easier
for you to being sending notifications.

- Email Notifications

Even though MT-Notifier is installed, email notifications must be enabled on
each blog for which you want to allow notifications to be sent.  This means that
you don't have to send notifications from every blog you host.  Simply use the
Configure option from the main menu and enable your blogs as you'd like.  These
notifications also don't need to be turned on in order to send (or even subscribe
to) notifications - but they must be turned on in order to send the notification 
email.

- Movable Type Integration

Because of limitations to the callback architecture in Movable Type 3.0D, an
additional hack is necessary if you'd like to add a 'subscribe' checkbox to your
comment forms, to allow posting and subscribing in one step.  However, this
process has been automated somewhat for you.  Again using the Configure option,
simply click the "install" link to make the necessary changes to your Comments.pm
file.  As of versoin 2.0.1, MT-Notifier is not compatible with MT-Blacklist.
Forthcoming versions of MT-Blacklist should be compatible with MT 3.0D, and at
such time, I will do everything I can to make them work together.

You can then click the "remove" link to restore your file to its prior state.

If you don't want to change your existing comments form, and would like to only
submit subscriptions directly to MT-Notifier, then this information does not 
matter to you (see below for more details).

*** -------------------------------------------------------------------- ***

Creating Subscriptions

- If you'd like to use your existing comments form to allow users to add an
email to the subscription list, add a field named "subscribe" to the form.
I used a checkbox myself, but you should be able to use about any sort of
input field that is sent to the script.

Make sure that you update not only your comments form on the individual
template or comment listing template, but also your comment preview and
comment error templates too.

As there is no MT template tag for this value, you'll either need to use
PHP (or another method) to set the value of the field correctly, or simply
display the field again and let the user check it again before submitting.
If the latter, you may want to include a message to that effect to draw their
attention.

- In order to subscribe an address to an entry or create an opt-out record, you
will need to send a string directly to MT-Notifier with the appropriate
information.  To subscribe, include the email address (mail) and the key (dkey)
to which you'd like to subscribe:

 http://www.example.com/cgi-bin/mt/mt-notifier.cgi?mail=user@domain.com&dkey=1:0

If you want to create a subscription to a blog, include the blog id, followed by
a colon and a zero.  For instance, to create a subscription to blog 7, your link
would look like this:

 http://www.example.com/cgi-bin/mt/mt-notifier.cgi?mail=user@domain.com&dkey=7:0

For a category, you include the category ID, followed by a colon and a capital C.
To subscribe to category 16, your subscription link would look like this:

 http://www.example.com/cgi-bin/mt/mt-notifier.cgi?mail=user@domain.com&dkey=16:C

For an entry, you start the key with a 0, follow it with a colon, and end with the
entry id.  For example, with entry 274, the link would look like this:

 http://www.example.com/cgi-bin/mt/mt-notifier.cgi?mail=user@domain.com&dkey=0:274

This makes it very easy to create a form that will allow you to subscribe to that
entry, that category, or even that entire blog.  Just use code similar to the
following:

  <form method="get" action="http://www.example.com/cgi-bin/mt/mt-notifier.cgi">
    <input type="hidden" name="dkey" value="0:<$MTEntryID$>">
    <font>Subscribe Without Commenting</font><br/ ><br />
    <input name="mail" />
    <input type="submit" class="button" value="Go">
  </form>

This example form would be to subscribe to an individual entry.  For categories, just
change the value of dkey to "<$MTCategoryID$>:C", and for blogs, change the value to
"<$MTBlogID$>:0".  Or populate the keys however else you prefer.  Just so long as it
is sent correctly to the mt-notifier script, it doesn't matter how the value gets
populated.

Because of the changes to the architecture in MT-Notifier v2.0.1, your existing stand-
alone forms will probably need to be changed so that they will still work.

*** -------------------------------------------------------------------- ***

Using Notifications:

Once installed, Notifier will send a brief email describing the comment and
a link to the entry where the comment was left.  Also included are a link that
allows managing user subscriptions.  These methods do not require the user
to login to the MT system.

*** -------------------------------------------------------------------- ***

Still to Come:

The new architecture of MT-Notifier will allow for adding additional storage
methods with relative ease.  Also on the list are a number of requested changes -
just be patient.  They'll be along shortly.

If you have requested a feature, or have a feature that you'd like to request, 
please keep in mind that I don't receive compensation for MT-Notifier.  I built
it because I wanted to do so, and while I'll continue to do that, the more time
it takes away from my real job, the less I'll be able to justify any continued
development.  If you'd like to see MT-Notifier continue to grow, think about
showing some love so that I don't have to make that decision.  Thanks.

*** -------------------------------------------------------------------- ***

Changelog:
2.2.4
  - Updated manage_address login to handle $mail/$code as well as $akey.
  - September 6, 2004
2.2.3
  - Corrected module_magic for MT 3.1.
  - September 4, 2004
2.2.2
  - Re-fixed 2.2 change.
  - September 3, 2004
2.2.1
  - Repackaged with directory structure.
  - August 25, 2004
2.2
  - Fixed subscription routine outside of management interface.
  - July 25, 2004
2.1
  - Added conversion of EZ Subscribe to Comments data.
  - July 15, 2004
2.0.1
  - Re-designed/cleaned up user interface.
  - Fixed redirects when login required.
  - Updated interface to MT 3-style design.
  - Updated data access to use subroutines.
  - Updated purge interface with more options.
  - Updated conversion from Scripty Goddess.
  - Updated hackomatic to process subscribe.
  - Added category subscriptions and opt-out records.
  - Added translation hooks for most text strings.
  - Added admin and user management interface.
  - Added enabler sub for configuration.
  - Added conversion from Notifier version 1.
  - Added skip first message to commentor.
  - Standardized error messages.
  - July 6, 2004
1.4.1
  - Fixed $sender variable declaration.
  - March 17, 2004
1.4
  - Added auto-backup and auto-hack functions.
  - Fixed some tags in the template to be XHTML-compliant.
  - February 6, 2004
1.3
  - Added conversion of ScriptyGoddess subscription data.
  - Fixed distribution package.
  - December 15, 2003
1.2
  - Added per-blog and per-install default "from" addresses.
  - Added subroutine to get an email address for the sender.
  - Added purge of address information.
  - Fixed purges to work correctly.
  - Removed $SENDER variable.
  - December 10, 2003
1.1
  - Added redirect information on confirmation screen.
  - Added additional author information to notification email.
  - Use entry author first, then $SENDER.
  - November 20, 2003
1.0
  - Initial release
  - November 19, 2003
